import{_ as n,c as s,o as a,d as p}from"./app.35cc8530.js";const d='{"title":"createMemoryHistory","description":"","frontmatter":{},"headers":[],"relativePath":"vue-router/createMemoryHistory.md"}',t={},e=p(`<h1 id="creatememoryhistory" tabindex="-1">createMemoryHistory <a class="header-anchor" href="#creatememoryhistory" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>\u521B\u5EFA\u4E00\u4E2A\u57FA\u4E8E\u5185\u5B58\u7684\u5386\u53F2\u8BB0\u5F55\u3002</p><p>\u6587\u4EF6\u4F4D\u7F6E\uFF1A <code>src/history/memory.ts</code></p></div><p>\u57FA\u4E8E\u5185\u5B58\u7684\u5386\u53F2\u8BB0\u5F55\u5185\u90E8\u901A\u8FC7\u7EF4\u62A4\u4E00\u4E2A\u961F\u5217<code>queue</code>\u548C\u4E00\u4E2A<code>position</code>\uFF0C\u6765\u4FDD\u8BC1\u5386\u53F2\u8BB0\u5F55\u5B58\u50A8\u7684\u6B63\u786E\u6027\u3002</p><p><code>createMemoryHistory</code>\u548C<code>createWebHistory</code>\u3001<code>createWebHashHistory</code>\u4E00\u6837\u63A5\u6536\u4E00\u4E2A<code>base</code>\u53C2\u6570\uFF0C\u4E0D\u540C\u7684\u662F<code>createMemoryHistory</code>\u4E2D<code>base</code>\u4F1A\u9ED8\u8BA4\u8BBE\u7F6E\u7A7A\u5B57\u7B26\u4E32\u3002</p><p>\u4E0B\u9762\u5206\u6790<code>createMemoryHistory</code>\uFF1A</p><p>\u9996\u5148\u58F0\u660E\u4E00\u4E2A<code>listeners</code>\u6570\u7EC4\u6765\u5B58\u50A8\u6240\u6709\u7684\u76D1\u542C\u51FD\u6570\u3001\u58F0\u660E\u4E00\u4E2A<code>queue</code>\u961F\u5217\u5B58\u50A8\u5386\u53F2\u8BB0\u5F55\u3001\u58F0\u660E\u4E00\u4E2A\u521D\u59CB\u503C\u4E3A<code>0</code>\u7684\u53D8\u91CF<code>position</code>\u6765\u8BB0\u5F55\u5F53\u524D\u6240\u5904\u7684\u5386\u53F2\u8BB0\u5F55\u5728<code>queue</code>\u4E2D\u7684\u7D22\u5F15\u3002</p><div class="language-ts line-numbers-mode"><pre><code><span class="token comment">// \u7528\u6237\u5B58\u50A8\u76D1\u542C\u51FD\u6570\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> listeners<span class="token operator">:</span> NavigationCallback<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">// \u4F7F\u7528\u4E00\u4E2A\u961F\u5217\u7EF4\u62A4\u5386\u53F2\u8BB0\u5F55</span>
<span class="token keyword">let</span> queue<span class="token operator">:</span> HistoryLocation<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">START</span><span class="token punctuation">]</span>
<span class="token comment">// \u5F53\u524D\u5386\u53F2\u8BB0\u5F55\u5728\u961F\u5217\u4E2D\u7684\u4F4D\u7F6E</span>
<span class="token keyword">let</span> position<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u7136\u540E\u5BF9<code>base</code>\u8FDB\u884C\u5E8F\u5217\u5316\u3002</p><div class="language-ts line-numbers-mode"><pre><code><span class="token comment">// base\u5E8F\u5217\u5316</span>
base <span class="token operator">=</span> <span class="token function">normalizeBase</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u7D27\u63A5\u7740\u58F0\u660E\u4E86\u4E00\u4E2A\u8BBE\u7F6E\u5386\u53F2\u8BB0\u5F55\u7684\u51FD\u6570\u548C\u4E00\u4E2A\u89E6\u53D1\u76D1\u542C\u7684\u51FD\u6570\uFF1A</p><div class="language-ts line-numbers-mode"><pre><code><span class="token comment">// \u8BBE\u7F6E\u5386\u53F2\u8BB0\u5F55</span>
<span class="token keyword">function</span> <span class="token function">setLocation</span><span class="token punctuation">(</span>location<span class="token operator">:</span> HistoryLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  position<span class="token operator">++</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">===</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we are at the end, we can simply append a new entry</span>
    <span class="token comment">// \u961F\u5217\u957F\u5EA6\u7B49\u4E8Eposition\u65F6\uFF0C\u76F4\u63A5push</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5F53\u5386\u53F2\u8BB0\u5F55\u5728\u961F\u5217\u4E2D\u7684\u975E\u672B\u5C3E\u4F4D\u7F6E\u65F6\uFF0C\u5220\u9664position\u53CA\u4E4B\u540E\u7684\u8BB0\u5F55\uFF0C\u7136\u540E\u518Dpush</span>
    <span class="token comment">// \u5982\u679C\u67D0\u4E00\u523B\u5904\u5728\u975E\u7ED3\u5C3E\u7684\u5386\u53F2\u8BB0\u5F55\u65F6\uFF0C\u8FD9\u65F6\u8981\u8FDB\u884Cpush\u6216reqlace\u64CD\u4F5C\uFF0C\u6B64\u65F6position\u4E4B\u540E\u7684\u8BB0\u5F55\u5C31\u4F1A\u5931\u6548</span>
    queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u89E6\u53D1\u76D1\u542C</span>
<span class="token keyword">function</span> <span class="token function">triggerListeners</span><span class="token punctuation">(</span>
  to<span class="token operator">:</span> HistoryLocation<span class="token punctuation">,</span>
  from<span class="token operator">:</span> HistoryLocation<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> direction<span class="token punctuation">,</span> delta <span class="token punctuation">}</span><span class="token operator">:</span> Pick<span class="token operator">&lt;</span>NavigationInformation<span class="token punctuation">,</span> <span class="token string">&#39;direction&#39;</span> <span class="token operator">|</span> <span class="token string">&#39;delta&#39;</span><span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> info<span class="token operator">:</span> NavigationInformation <span class="token operator">=</span> <span class="token punctuation">{</span>
    direction<span class="token punctuation">,</span>
    delta<span class="token punctuation">,</span>
    type<span class="token operator">:</span> NavigationType<span class="token punctuation">.</span>pop<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> callback <span class="token keyword">of</span> listeners<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> info<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>\u7136\u540E\u548C<code>createWebHistory</code>\u4E00\u6837\u58F0\u660E\u4E00\u4E2A<code>routerHistory</code>\uFF0C\u5E76\u62E6\u622A<code>routerHistory.location</code>,\u4F7F\u5176\u8FD4\u56DE\u5F53\u524D\u7684\u5386\u53F2\u8BB0\u5F55\u3002</p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">const</span> routerHistory<span class="token operator">:</span> RouterHistory <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// rewritten by Object.defineProperty</span>
  location<span class="token operator">:</span> <span class="token constant">START</span><span class="token punctuation">,</span>
  <span class="token comment">// TODO: should be kept in queue</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  base<span class="token punctuation">,</span>
  createHref<span class="token operator">:</span> <span class="token function">createHref</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token comment">// \u66FF\u6362\u5386\u53F2\u8BB0\u5F55</span>
  <span class="token function">replace</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// remove current entry and decrement position</span>
    queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>position<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">setLocation</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u6DFB\u52A0\u4E00\u6761\u8BB0\u5F55</span>
  <span class="token function">push</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> HistoryState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setLocation</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// \u6DFB\u52A0\u4E00\u4E2A\u76D1\u542C\u51FD\u6570\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u5378\u8F7D\u76D1\u542C\u7684\u51FD\u6570</span>
  <span class="token function">listen</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> index <span class="token operator">=</span> listeners<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> listeners<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">// \u9500\u6BC1\u5386\u53F2\u8BB0\u5F55</span>
  <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">START</span><span class="token punctuation">]</span>
    position <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">go</span><span class="token punctuation">(</span>delta<span class="token punctuation">,</span> shouldTrigger <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4ECE\u54EA\u6761\u8BB0\u5F55\u8DF3\u8F6C</span>
    <span class="token keyword">const</span> from <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>location
    <span class="token comment">// go\u7684\u65B9\u5411\u3002delta &lt; 0 \u4E3A back\uFF0C\u76F8\u53CD\u4E3A forward</span>
    <span class="token keyword">const</span> direction<span class="token operator">:</span> NavigationDirection <span class="token operator">=</span>
      <span class="token comment">// we are considering delta === 0 going forward, but in abstract mode</span>
      <span class="token comment">// using 0 for the delta doesn&#39;t make sense like it does in html5 where</span>
      <span class="token comment">// it reloads the page</span>
      delta <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> NavigationDirection<span class="token punctuation">.</span>back <span class="token operator">:</span> NavigationDirection<span class="token punctuation">.</span>forward
    <span class="token comment">// go\u4E4B\u540E\u6240\u5904\u7684position\uFF1AMath.min(position + delta, queue.length - 1)\u4FDD\u8BC1\u4E86position&lt;=queue.length - 1, \u5982\u679Cposition + delta\u8D85\u51FA\u4E86\u6570\u7EC4\u6700\u5927\u7D22\u5F15\uFF0C\u5C31\u53D6\u6700\u5927\u7D22\u5F15</span>
    <span class="token comment">// Math.max(0, Math.min(position + delta, queue.length - 1))\u8FDB\u4E00\u6B65\u4FDD\u8BC1\u4E86position&gt;=0\uFF0C\u5982\u679Cposition + delta &lt; 0, \u5219\u53D60</span>
    position <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>position <span class="token operator">+</span> delta<span class="token punctuation">,</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// \u6839\u636EshouldTrigger\u51B3\u5B9A\u662F\u5426\u89E6\u53D1\u76D1\u542C\u51FD\u6570</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldTrigger<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">triggerListeners</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>location<span class="token punctuation">,</span> from<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        direction<span class="token punctuation">,</span>
        delta<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u8BBE\u7F6Elocation\u603B\u662F\u83B7\u53D6\u5F53\u524D\u8BB0\u5F55</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>routerHistory<span class="token punctuation">,</span> <span class="token string">&#39;location&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> queue<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>\u6700\u540E\u8FD4\u56DE<code>routerHistory</code>\u3002</p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">return</span> routerHistory
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>`,15),o=[e];function c(l,u,r,i,k,b){return a(),s("div",null,o)}var y=n(t,[["render",c]]);export{d as __pageData,y as default};
