import{_ as n,c as s,o as a,d as p}from"./app.90a49249.js";const d='{"title":"resolve","description":"","frontmatter":{},"headers":[],"relativePath":"vue-router/resolve.md"}',t={},o=p(`<h1 id="resolve" tabindex="-1">resolve <a class="header-anchor" href="#resolve" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>\u8FD4\u56DE\u8DEF\u7531\u5730\u5740\u7684\u6807\u51C6\u5316\u7248\u672C\u3002</p></div><p><code>resolve</code>\u63A5\u6536\u4E24\u4E2A\u53C2\u6570\uFF1A<code>rawLocation</code>\u3001<code>currentLocation</code>\uFF08\u53EF\u9009\uFF09\u3002\u5176\u4E2D<code>rawLocation</code>\u662F\u5F85\u8F6C\u6362\u7684\u8DEF\u7531\uFF0C<code>rawLocation</code>\u53EF\u4EE5\u662F\u4E2A\u5BF9\u8C61\u4E5F\u53EF\u4EE5\u662F\u4E2A\u5B57\u7B26\u4E32\u3002<code>currentLocation</code>\u4E0D\u4F20\u9ED8\u8BA4\u662F<code>currentRoute</code>\u3002</p><p>\u5728<code>resolve</code>\u4E2D\u6709\u662F\u4E24\u4E2A\u5206\u652F\uFF1A</p><ul><li>\u5982\u679C<code>rawLocation</code>\u662F<code>string</code>\u7C7B\u578B \u8C03\u7528<code>parseURL</code>\u89E3\u6790<code>rawLocation</code>:</li></ul><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">const</span> locationNormalized <span class="token operator">=</span> <span class="token function">parseURL</span><span class="token punctuation">(</span>
  parseQuery<span class="token punctuation">,</span>
  rawLocation<span class="token punctuation">,</span>
  currentLocation<span class="token punctuation">.</span>path
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>parseURL</code>\u63A5\u6536\u4E09\u4E2A\u53C2\u6570\uFF1A<code>parseQuery</code>\uFF08\u4E00\u4E2Aquery\u89E3\u6790\u51FD\u6570\uFF09\u3001<code>location</code>\uFF08\u88AB\u89E3\u6790\u7684<code>location</code>\uFF09\u3001<code>currentLocation</code>\uFF08\u5F53\u524D\u7684<code>location</code>\uFF09\u3002</p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">parseURL</span><span class="token punctuation">(</span>
  <span class="token function-variable function">parseQuery</span><span class="token operator">:</span> <span class="token punctuation">(</span>search<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> LocationQuery<span class="token punctuation">,</span>
  location<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  currentLocation<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;/&#39;</span>
<span class="token punctuation">)</span><span class="token operator">:</span> LocationNormalized <span class="token punctuation">{</span>
  <span class="token keyword">let</span> path<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    query<span class="token operator">:</span> LocationQuery <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    searchString <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
    hash <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>

  <span class="token comment">// location\u4E2D?\u7684\u4F4D\u7F6E</span>
  <span class="token keyword">const</span> searchPos <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// location\u4E2D#\u7684\u4F4D\u7F6E\uFF0C\u5982\u679Clocation\u4E2D\u6709?\uFF0C\u5728?\u4E4B\u540E\u627E#</span>
  <span class="token keyword">const</span> hashPos <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">,</span> searchPos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> searchPos <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// \u5982\u679C</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>searchPos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u4ECElocation\u4E2D\u622A\u53D6[0, searchPos)\u4F4D\u7F6E\u7684\u5B57\u7B26\u4E32\u4F5C\u4E3Apath</span>
    path <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> searchPos<span class="token punctuation">)</span>
    <span class="token comment">// \u4ECElocation\u622A\u53D6\u542Bsearch\u7684\u5B57\u7B26\u4E32\uFF0C\u4E0D\u5305\u542Bhash\u90E8\u5206</span>
    searchString <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>
      searchPos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      hashPos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> hashPos <span class="token operator">:</span> location<span class="token punctuation">.</span>length
    <span class="token punctuation">)</span>
    <span class="token comment">// \u8C03\u7528parseQuery\u751F\u6210query\u5BF9\u8C61</span>
    query <span class="token operator">=</span> <span class="token function">parseQuery</span><span class="token punctuation">(</span>searchString<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5982\u679Clocation\u4E2D\u6709hash</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hashPos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    path <span class="token operator">=</span> path <span class="token operator">||</span> location<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> hashPos<span class="token punctuation">)</span>
    <span class="token comment">// \u4ECElocation\u4E2D\u622A\u53D6[hashPos, location.length)\u4F5C\u4E3Ahash\uFF08\u5305\u542B#\uFF09</span>
    hash <span class="token operator">=</span> location<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>hashPos<span class="token punctuation">,</span> location<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u89E3\u6790\u4EE5.\u5F00\u5934\u7684\u76F8\u5BF9\u8DEF\u5F84</span>
  path <span class="token operator">=</span> <span class="token function">resolveRelativePath</span><span class="token punctuation">(</span>path <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> path <span class="token operator">:</span> location<span class="token punctuation">,</span> currentLocation<span class="token punctuation">)</span>
  <span class="token comment">// empty path means a relative query or hash \`?foo=f\`, \`#thing\`</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
  	<span class="token comment">// fullPath = path + searchString + hash</span>
    fullPath<span class="token operator">:</span> path <span class="token operator">+</span> <span class="token punctuation">(</span>searchString <span class="token operator">&amp;&amp;</span> <span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> searchString <span class="token operator">+</span> hash<span class="token punctuation">,</span>
    path<span class="token punctuation">,</span>
    query<span class="token punctuation">,</span>
    hash<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>\u6765\u770B\u4E0B\uFF0C\u76F8\u5BF9\u8DEF\u5F84\u7684\u89E3\u6790\u8FC7\u7A0B\uFF1A</p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resolveRelativePath</span><span class="token punctuation">(</span>to<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> from<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5982\u679Cto\u4EE5/\u5F00\u5934\uFF0C\u8BF4\u660E\u662F\u4E2A\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u76F4\u63A5\u8FD4\u56DE\u5373\u53EF</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> to
  <span class="token comment">// \u5982\u679Cfrom\u4E0D\u662F\u4EE5/\u5F00\u5934\uFF0C\u90A3\u4E48\u8BF4\u660Efrom\u4E0D\u662F\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u4E5F\u5C31\u65E0\u6CD5\u63A8\u6D4B\u51FAto\u7684\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u6B64\u65F6\u76F4\u63A5\u8FD4\u56DEto</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__ <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>from<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Cannot resolve a relative location without an absolute path. Trying to resolve &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>to<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; from &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">from</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;. It should look like &quot;/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">from</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> to
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>to<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">from</span>
  <span class="token comment">// \u4F7F\u7528/\u5206\u5272from\u4E0Eto</span>
  <span class="token keyword">const</span> fromSegments <span class="token operator">=</span> from<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> toSegments <span class="token operator">=</span> to<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>

  <span class="token comment">// \u521D\u59CB\u5316position\u9ED8\u8BA4\u4E3AfromSegments\u7684\u6700\u540E\u4E00\u4E2A\u7D22\u5F15</span>
  <span class="token keyword">let</span> position <span class="token operator">=</span> fromSegments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">let</span> toPosition<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token keyword">let</span> segment<span class="token operator">:</span> <span class="token builtin">string</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span>toPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> toPosition <span class="token operator">&lt;</span> toSegments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> toPosition<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    segment <span class="token operator">=</span> toSegments<span class="token punctuation">[</span>toPosition<span class="token punctuation">]</span>
    <span class="token comment">// \u4FDD\u8BC1position\u4E0D\u4F1A\u5C0F\u4E8E0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">||</span> segment <span class="token operator">===</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>segment <span class="token operator">===</span> <span class="token string">&#39;..&#39;</span><span class="token punctuation">)</span> position<span class="token operator">--</span>
    <span class="token keyword">else</span> <span class="token keyword">break</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    fromSegments<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token string">&#39;/&#39;</span> <span class="token operator">+</span>
    toSegments
      <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>toPosition <span class="token operator">-</span> <span class="token punctuation">(</span>toPosition <span class="token operator">===</span> toSegments<span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p><code>to=cc</code>\uFF0C<code>from=/aa/bb</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa/cc</code></p><p><code>to=cc</code>\uFF0C<code>from=/aa/bb/</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa/bb/cc</code></p><p><code>to=./cc</code>\uFF0C<code>from=/aa/bb</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa/cc</code></p><p><code>to=./cc</code>\uFF0C<code>from=/aa/bb/</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa/bb/cc</code></p><p><code>to=../cc</code>\uFF0C<code>from=/aa/bb</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa</code></p><p><code>to=../cc</code>\uFF0C<code>from=/aa/bb/</code>\uFF0C\u7ECF\u8FC7<code>resolveRelativePath</code>\u540E\uFF1A<code>/aa/cc</code></p><p>\u5982\u679C<code>from/</code>\uFF0C<code>to=cc</code>\u3001<code>to=./cc</code>\u3001<code>to=../cc</code>\u3001<code>to=../../cc</code>\u3001<code>to=./../cc</code>\u3001<code>to=.././cc</code>\u7ECF\u8FC7<code>resolveRelativePath</code>\u59CB\u7EC8\u8FD4\u56DE<code>/cc</code></p><p>\u56DE\u5230<code>resolve</code>\u4E2D\uFF0C\u89E3\u6790\u5B8C<code>rawLocation</code>\u540E\uFF0C\u8C03\u7528<code>matcher.resolve</code></p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">const</span> matchedRoute <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> locationNormalized<span class="token punctuation">.</span>path <span class="token punctuation">}</span><span class="token punctuation">,</span>
  currentLocation
<span class="token punctuation">)</span>
<span class="token comment">// \u4F7F\u7528routerHistory.createHref\u521B\u5EFAhref</span>
<span class="token keyword">const</span> href <span class="token operator">=</span> routerHistory<span class="token punctuation">.</span><span class="token function">createHref</span><span class="token punctuation">(</span>locationNormalized<span class="token punctuation">.</span>fullPath<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>\u6700\u540E\u8FD4\u56DE\u5BF9\u8C61\uFF1A</p><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">return</span> <span class="token function">assign</span><span class="token punctuation">(</span>locationNormalized<span class="token punctuation">,</span> matchedRoute<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5BF9params\u4E2D\u7684value\u8FDB\u884CdecodeURIComponent</span>
  params<span class="token operator">:</span><span class="token function">decodeParams</span><span class="token punctuation">(</span>matchedRoute<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// \u5BF9hash\u8FDB\u884CdecodeURIComponent</span>
  hash<span class="token operator">:</span> <span class="token function">decode</span><span class="token punctuation">(</span>locationNormalized<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span>
  redirectedFrom<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  href<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li><code>rawLocation</code>\u4E0D\u662F<code>string</code>\u7C7B\u578B</li></ul><div class="language-ts line-numbers-mode"><pre><code><span class="token keyword">let</span> matcherLocation<span class="token operator">:</span> MatcherLocationRaw

<span class="token comment">// \u5982\u679CrawLocation\u4E2D\u6709path\u5C5E\u6027</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span> <span class="token keyword">in</span> rawLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// rawLocation\u4E2D\u7684params\u4F1A\u88AB\u5FFD\u7565</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    __DEV__ <span class="token operator">&amp;&amp;</span>
    <span class="token string">&#39;params&#39;</span> <span class="token keyword">in</span> rawLocation <span class="token operator">&amp;&amp;</span>
    <span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span> <span class="token keyword">in</span> rawLocation<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>rawLocation<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Path &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>
        rawLocation<span class="token punctuation">.</span>path
      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; was passed with params but they will be ignored. Use a named route alongside params instead.</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5904\u7406path\u4E3A\u7EDD\u5BF9\u8DEF\u5F84</span>
  matcherLocation <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawLocation<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token function">parseURL</span><span class="token punctuation">(</span>parseQuery<span class="token punctuation">,</span> rawLocation<span class="token punctuation">.</span>path<span class="token punctuation">,</span> currentLocation<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5220\u9664\u7A7A\u7684\u53C2\u6570</span>
  <span class="token keyword">const</span> targetParams <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawLocation<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> targetParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> targetParams<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u5BF9params\u8FDB\u884C\u7F16\u7801</span>
  matcherLocation <span class="token operator">=</span> <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawLocation<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token function">encodeParams</span><span class="token punctuation">(</span>rawLocation<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// \u5C06\u5F53\u524D\u4F4D\u7F6E\u7684params\u7F16\u7801 \u5F53\u524D\u4F4D\u7F6E\u7684\u53C2\u6570\u88AB\u89E3\u7801\uFF0C\u6211\u4EEC\u9700\u8981\u5BF9\u5B83\u4EEC\u8FDB\u884C\u7F16\u7801\u4EE5\u9632\u5339\u914D\u5668\u5408\u5E76\u53C2\u6570</span>
  currentLocation<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token function">encodeParams</span><span class="token punctuation">(</span>currentLocation<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u8C03\u7528matcher.resolve\u83B7\u53D6\u8DEF\u7531\u76F8\u5173\u4FE1\u606F</span>
<span class="token keyword">const</span> matchedRoute <span class="token operator">=</span> matcher<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>matcherLocation<span class="token punctuation">,</span> currentLocation<span class="token punctuation">)</span>
<span class="token keyword">const</span> hash <span class="token operator">=</span> rawLocation<span class="token punctuation">.</span>hash <span class="token operator">||</span> <span class="token string">&#39;&#39;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__ <span class="token operator">&amp;&amp;</span> hash <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>hash<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">warn</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">A \\\`hash\\\` should always start with the character &quot;#&quot;. Replace &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with &quot;#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>hash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u7531\u4E8Ematcher\u5DF2\u7ECF\u5408\u5E76\u4E86\u5F53\u524D\u4F4D\u7F6E\u7684\u53C2\u6570\uFF0C\u6240\u4EE5\u9700\u8981\u8FDB\u884C\u89E3\u7801</span>
matchedRoute<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token function">normalizeParams</span><span class="token punctuation">(</span><span class="token function">decodeParams</span><span class="token punctuation">(</span>matchedRoute<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// \u751F\u6210\u5B8C\u6574path</span>
<span class="token keyword">const</span> fullPath <span class="token operator">=</span> <span class="token function">stringifyURL</span><span class="token punctuation">(</span>
  stringifyQuery<span class="token punctuation">,</span>
  <span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> rawLocation<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    hash<span class="token operator">:</span> <span class="token function">encodeHash</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> matchedRoute<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// routerHistory.createHref\u4F1A\u5220\u9664#\u4E4B\u524D\u7684\u4EFB\u610F\u5B57\u7B26</span>
<span class="token keyword">const</span> href <span class="token operator">=</span> routerHistory<span class="token punctuation">.</span><span class="token function">createHref</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&#39;//&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Location &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>rawLocation<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; resolved to &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>href<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;. A resolved location cannot start with multiple slashes.</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matchedRoute<span class="token punctuation">.</span>matched<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">No match found for location with path &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>
        <span class="token string">&#39;path&#39;</span> <span class="token keyword">in</span> rawLocation <span class="token operator">?</span> rawLocation<span class="token punctuation">.</span>path <span class="token operator">:</span> rawLocation
      <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token function">assign</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    fullPath<span class="token punctuation">,</span>
    hash<span class="token punctuation">,</span>
    query<span class="token operator">:</span>
    <span class="token comment">// \u5982\u679Cquery\u662F\u4E2A\u5D4C\u5957\u5BF9\u8C61\uFF0CnormalizeQuery\u4F1A\u5C06\u5D4C\u5957\u7684\u5BF9\u8C61toString\uFF0C\u5982\u679C\u7528\u6237\u4F7F\u7528qs\u7B49\u5E93\uFF0C\u6211\u4EEC\u9700\u8981\u4FDD\u6301query\u7684\u72B6\u6001</span>
    <span class="token comment">// https://github.com/vuejs/router/issues/328#issuecomment-649481567</span>
      stringifyQuery <span class="token operator">===</span> originalStringifyQuery
        <span class="token operator">?</span> <span class="token function">normalizeQuery</span><span class="token punctuation">(</span>rawLocation<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>rawLocation<span class="token punctuation">.</span>query <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> LocationQuery<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  matchedRoute<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    redirectedFrom<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    href<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div>`,23),e=[o];function c(l,r,u,i,k,b){return a(),s("div",null,e)}var h=n(t,[["render",c]]);export{d as __pageData,h as default};
